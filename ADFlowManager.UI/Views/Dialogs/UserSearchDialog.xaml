<Window
    x:Class="ADFlowManager.UI.Views.Dialogs.UserSearchDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="Rechercher des utilisateurs"
    Width="560"
    Height="520"
    WindowStartupLocation="CenterOwner"
    ResizeMode="NoResize"
    Background="#1E1E1E">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock
            x:Name="PromptText"
            Grid.Row="0"
            Text="Rechercher des utilisateurs à ajouter"
            FontSize="16"
            FontWeight="SemiBold"
            Foreground="#F5F5F5"
            TextWrapping="Wrap"
            Margin="0,0,0,16" />

        <!-- Search box -->
        <Grid Grid.Row="1">
            <ui:TextBox
                x:Name="SearchTextBox"
                PlaceholderText="Tapez pour rechercher un utilisateur..."
                Background="#2D2D30"
                Foreground="#F5F5F5"
                BorderBrush="#3F3F46"
                Height="42"
                FontSize="14"
                TextChanged="SearchTextBox_TextChanged"
                KeyDown="SearchTextBox_KeyDown">
                <ui:TextBox.Icon>
                    <ui:SymbolIcon Symbol="Search24" Foreground="#8B5CF6" />
                </ui:TextBox.Icon>
            </ui:TextBox>

            <!-- Dropdown results -->
            <Popup
                x:Name="SuggestPopup"
                PlacementTarget="{Binding ElementName=SearchTextBox}"
                Placement="Bottom"
                StaysOpen="False"
                AllowsTransparency="True"
                PopupAnimation="Fade"
                Width="{Binding ActualWidth, ElementName=SearchTextBox}">
                <Border
                    Background="#252525"
                    BorderBrush="#3F3F46"
                    BorderThickness="1"
                    CornerRadius="0,0,6,6"
                    MaxHeight="200">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="SuggestList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Background="Transparent"
                                        Padding="12,8"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="SuggestItem_Click">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#3B2D5E" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <StackPanel Orientation="Horizontal">
                                            <ui:SymbolIcon
                                                Symbol="Person24"
                                                FontSize="16"
                                                Foreground="#8B5CF6"
                                                Margin="0,0,10,0"
                                                VerticalAlignment="Center" />
                                            <StackPanel>
                                                <TextBlock
                                                    Text="{Binding DisplayName}"
                                                    FontSize="13"
                                                    FontWeight="SemiBold"
                                                    Foreground="#F5F5F5" />
                                                <TextBlock
                                                    Text="{Binding UserName}"
                                                    FontSize="11"
                                                    Foreground="#A1A1AA" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
            </Popup>
        </Grid>

        <!-- Selected users label -->
        <TextBlock
            Grid.Row="2"
            x:Name="SelectedLabel"
            Text="Utilisateurs sélectionnés :"
            FontSize="12"
            FontWeight="SemiBold"
            Foreground="#71717A"
            Margin="0,16,0,8"
            Visibility="Collapsed" />

        <!-- Selected users list -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="SelectedList">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border
                            Background="#2D2D30"
                            CornerRadius="6"
                            Padding="12,8"
                            Margin="0,0,0,6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ui:SymbolIcon
                                    Grid.Column="0"
                                    Symbol="Person24"
                                    FontSize="16"
                                    Foreground="#8B5CF6"
                                    Margin="0,0,10,0"
                                    VerticalAlignment="Center" />

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock
                                        Text="{Binding DisplayName}"
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        Foreground="#F5F5F5" />
                                    <TextBlock
                                        Text="{Binding UserName}"
                                        FontSize="11"
                                        Foreground="#A1A1AA" />
                                </StackPanel>

                                <ui:Button
                                    Grid.Column="2"
                                    Appearance="Secondary"
                                    Width="28" Height="28"
                                    Padding="0"
                                    VerticalAlignment="Center"
                                    ToolTip="Retirer"
                                    Click="RemoveSelected_Click"
                                    Tag="{Binding UserName}">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="Dismiss24" FontSize="12" />
                                    </ui:Button.Icon>
                                </ui:Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <ui:Button
                Content="Annuler"
                Appearance="Secondary"
                Click="CancelButton_Click"
                Height="36"
                Padding="24,0"
                Margin="0,0,8,0" />
            <ui:Button
                x:Name="ValidateButton"
                Content="Valider (0)"
                Appearance="Primary"
                Click="OkButton_Click"
                Height="36"
                Padding="24,0"
                IsEnabled="False" />
        </StackPanel>
    </Grid>
</Window>
