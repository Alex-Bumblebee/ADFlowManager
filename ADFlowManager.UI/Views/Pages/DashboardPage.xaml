<Page
    x:Class="ADFlowManager.UI.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:local="clr-namespace:ADFlowManager.UI.Views.Pages"
    xmlns:ext="clr-namespace:ADFlowManager.UI.Extensions"
    Title="{ext:Localized Nav_Home}"
    d:DesignHeight="900"
    d:DesignWidth="1400"
    mc:Ignorable="d">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="32,8,32,48">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- ===== HEADER BRANDING ===== -->
            <Grid Grid.Row="0" Margin="0,0,0,40">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Logo + Titre -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <!-- Logo Assets/logo.png -->
                    <Border
                        Background="#1E1E1E"
                        CornerRadius="16"
                        Padding="12"
                        Width="80"
                        Height="80"
                        Margin="0,0,20,0">
                        <Image
                            Source="pack://application:,,,/Assets/logo.png"
                            Stretch="Uniform" />
                    </Border>

                    <StackPanel VerticalAlignment="Center">
                        <TextBlock
                            Text="ADFlowManager"
                            FontSize="36"
                            FontWeight="Bold"
                            Foreground="#F5F5F5" />

                        <TextBlock
                            FontSize="14"
                            Foreground="#71717A"
                            Margin="0,4,0,0">
                            <Run Text="{ext:Localized Dashboard_Version}" />
                            <Run Text="{Binding AppVersion, Mode=OneWay}" FontWeight="SemiBold" Foreground="#A855F7" />
                            <Run Text="  •  " />
                            <Run Text="{ext:Localized Dashboard_Subtitle}" />
                        </TextBlock>

                        <TextBlock
                            FontSize="13"
                            Foreground="#52525B"
                            Margin="0,4,0,0">
                            <Run Text="{ext:Localized Dashboard_Connected}" />
                            <Run Text="{Binding CurrentUser, Mode=OneWay}" Foreground="#A855F7" />
                            <Run Text="@" />
                            <Run Text="{Binding CurrentDomain, Mode=OneWay}" Foreground="#A855F7" />
                        </TextBlock>
                    </StackPanel>
                </StackPanel>

                <!-- Refresh button -->
                <ui:Button
                    Grid.Column="1"
                    Content="{ext:Localized Dashboard_Refresh}"
                    Appearance="Secondary"
                    Command="{Binding RefreshCommand}"
                    Height="44"
                    Padding="20,0"
                    VerticalAlignment="Center">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="ArrowSync24" />
                    </ui:Button.Icon>
                </ui:Button>
            </Grid>

            <!-- ===== STATS CARDS MODERNE ===== -->
            <Grid Grid.Row="1" Margin="0,0,0,32">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Card Utilisateurs -->
                <Border
                    Grid.Column="0"
                    Background="#1E1E1E"
                    CornerRadius="16"
                    Padding="28">
                    <Border.Effect>
                        <DropShadowEffect
                            Color="#A855F7"
                            Opacity="0.12"
                            BlurRadius="24"
                            ShadowDepth="0" />
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border
                                Background="#2D1B4E"
                                CornerRadius="12"
                                Width="48"
                                Height="48"
                                Margin="0,0,12,0">
                                <ui:SymbolIcon
                                    Symbol="People24"
                                    FontSize="24"
                                    Foreground="#A855F7"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock
                                    Text="{ext:Localized Dashboard_Users}"
                                    FontSize="13"
                                    Foreground="#A1A1AA" />
                                <TextBlock
                                    Text="{ext:Localized Dashboard_ActiveDirectory}"
                                    FontSize="11"
                                    Foreground="#52525B" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" VerticalAlignment="Bottom">
                            <TextBlock
                                Text="{Binding TotalUsers, Mode=OneWay}"
                                FontSize="52"
                                FontWeight="Bold"
                                Foreground="#F5F5F5"
                                Margin="0,0,0,4" />
                            <TextBlock
                                Text="{ext:Localized Dashboard_ActiveAccounts}"
                                FontSize="13"
                                Foreground="#71717A" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Card Groupes -->
                <Border
                    Grid.Column="2"
                    Background="#1E1E1E"
                    CornerRadius="16"
                    Padding="28">
                    <Border.Effect>
                        <DropShadowEffect
                            Color="#3B82F6"
                            Opacity="0.12"
                            BlurRadius="24"
                            ShadowDepth="0" />
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border
                                Background="#1B2A4E"
                                CornerRadius="12"
                                Width="48"
                                Height="48"
                                Margin="0,0,12,0">
                                <ui:SymbolIcon
                                    Symbol="PeopleTeam24"
                                    FontSize="24"
                                    Foreground="#3B82F6"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock
                                    Text="{ext:Localized Dashboard_Groups}"
                                    FontSize="13"
                                    Foreground="#A1A1AA" />
                                <TextBlock
                                    Text="{ext:Localized Dashboard_SecurityDistribution}"
                                    FontSize="11"
                                    Foreground="#52525B" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" VerticalAlignment="Bottom">
                            <TextBlock
                                Text="{Binding TotalGroups, Mode=OneWay}"
                                FontSize="52"
                                FontWeight="Bold"
                                Foreground="#F5F5F5"
                                Margin="0,0,0,4" />
                            <TextBlock
                                Text="{ext:Localized Dashboard_ConfiguredGroups}"
                                FontSize="13"
                                Foreground="#71717A" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Card Actions aujourd'hui -->
                <Border
                    Grid.Column="4"
                    Background="#1E1E1E"
                    CornerRadius="16"
                    Padding="28">
                    <Border.Effect>
                        <DropShadowEffect
                            Color="#10B981"
                            Opacity="0.12"
                            BlurRadius="24"
                            ShadowDepth="0" />
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                            <Border
                                Background="#1B3A2E"
                                CornerRadius="12"
                                Width="48"
                                Height="48"
                                Margin="0,0,12,0">
                                <ui:SymbolIcon
                                    Symbol="History24"
                                    FontSize="24"
                                    Foreground="#10B981"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock
                                    Text="{ext:Localized Dashboard_Activity}"
                                    FontSize="13"
                                    Foreground="#A1A1AA" />
                                <TextBlock
                                    Text="{ext:Localized Dashboard_Today}"
                                    FontSize="11"
                                    Foreground="#52525B" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" VerticalAlignment="Bottom">
                            <TextBlock
                                Text="{Binding ActionsToday, Mode=OneWay}"
                                FontSize="52"
                                FontWeight="Bold"
                                Foreground="#F5F5F5"
                                Margin="0,0,0,4" />
                            <TextBlock
                                Text="{ext:Localized Dashboard_ActionsPerformed}"
                                FontSize="13"
                                Foreground="#71717A" />
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- ===== ACTIVITÉ RÉCENTE + ACTIONS RAPIDES ===== -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Activité récente -->
                <Border
                    Grid.Column="0"
                    Background="#1E1E1E"
                    CornerRadius="16"
                    Padding="28">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Text="{ext:Localized Dashboard_RecentActivity}"
                            FontSize="22"
                            FontWeight="Bold"
                            Foreground="#F5F5F5"
                            Margin="0,0,0,20" />

                        <!-- Liste actions -->
                        <ScrollViewer Grid.Row="1" MaxHeight="500" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding RecentActivities}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Background="#252525"
                                            CornerRadius="12"
                                            Padding="16"
                                            Margin="0,0,0,10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Icône -->
                                                <Border
                                                    Grid.Column="0"
                                                    Background="#1B3A2E"
                                                    CornerRadius="10"
                                                    Width="40"
                                                    Height="40"
                                                    Margin="0,0,14,0"
                                                    VerticalAlignment="Center">
                                                    <ui:SymbolIcon
                                                        Symbol="CheckmarkCircle24"
                                                        FontSize="18"
                                                        Foreground="#10B981"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center" />
                                                </Border>

                                                <!-- Détails -->
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock
                                                        Text="{Binding Description}"
                                                        FontSize="14"
                                                        FontWeight="SemiBold"
                                                        Foreground="#F5F5F5"
                                                        TextWrapping="Wrap" />
                                                    <TextBlock
                                                        Text="{Binding TimeAgo}"
                                                        FontSize="12"
                                                        Foreground="#71717A"
                                                        Margin="0,4,0,0" />
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- État vide -->
                        <StackPanel
                            Grid.Row="1"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Margin="0,40,0,0"
                            Visibility="{Binding HasNoActions, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Border
                                Background="#252525"
                                CornerRadius="16"
                                Padding="40"
                                Width="300">
                                <StackPanel HorizontalAlignment="Center">
                                    <ui:SymbolIcon
                                        Symbol="History24"
                                        FontSize="48"
                                        Foreground="#3F3F46"
                                        HorizontalAlignment="Center"
                                        Margin="0,0,0,12" />
                                    <TextBlock
                                        Text="{ext:Localized Dashboard_NoRecentActivity}"
                                        FontSize="16"
                                        FontWeight="SemiBold"
                                        Foreground="#A1A1AA"
                                        HorizontalAlignment="Center" />
                                    <TextBlock
                                        Text="{ext:Localized Dashboard_NoRecentActivitySub}"
                                        FontSize="13"
                                        Foreground="#71717A"
                                        HorizontalAlignment="Center"
                                        Margin="0,4,0,0" />
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Actions rapides -->
                <Border
                    Grid.Column="2"
                    Background="#1E1E1E"
                    CornerRadius="16"
                    Padding="28">
                    <StackPanel>
                        <TextBlock
                            Text="{ext:Localized Dashboard_QuickActions}"
                            FontSize="22"
                            FontWeight="Bold"
                            Foreground="#F5F5F5"
                            Margin="0,0,0,20" />

                        <!-- Nouvel utilisateur -->
                        <ui:Button
                            Content="{ext:Localized Dashboard_NewUser}"
                            Appearance="Primary"
                            Command="{Binding NewUserCommand}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,12"
                            Height="52"
                            FontSize="14">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="PersonAdd24" />
                            </ui:Button.Icon>
                        </ui:Button>

                        <!-- Nouveau groupe -->
                        <ui:Button
                            Content="{ext:Localized Dashboard_NewGroup}"
                            Appearance="Secondary"
                            Command="{Binding NewGroupCommand}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,12"
                            Height="52"
                            FontSize="14">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="PeopleAdd24" />
                            </ui:Button.Icon>
                        </ui:Button>

                        <!-- Templates -->
                        <ui:Button
                            Content="{ext:Localized Dashboard_ManageTemplates}"
                            Appearance="Secondary"
                            Command="{Binding OpenTemplatesCommand}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,12"
                            Height="52"
                            FontSize="14">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="DocumentCopy24" />
                            </ui:Button.Icon>
                        </ui:Button>

                        <!-- Historique -->
                        <ui:Button
                            Content="{ext:Localized Dashboard_ViewHistory}"
                            Appearance="Secondary"
                            Command="{Binding OpenHistoryCommand}"
                            HorizontalAlignment="Stretch"
                            Margin="0,0,0,12"
                            Height="52"
                            FontSize="14">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="History24" />
                            </ui:Button.Icon>
                        </ui:Button>

                        <!-- Déconnexion -->
                        <Border
                            BorderBrush="#3F3F46"
                            BorderThickness="0,1,0,0"
                            Padding="0,16,0,0"
                            Margin="0,8,0,0">
                            <ui:Button
                                Content="{ext:Localized Dashboard_Disconnect}"
                                Appearance="Secondary"
                                Command="{Binding DisconnectCommand}"
                                HorizontalAlignment="Stretch"
                                Height="44"
                                FontSize="13"
                                Foreground="#EF4444">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="SignOut24" Foreground="#EF4444" />
                                </ui:Button.Icon>
                            </ui:Button>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</Page>
