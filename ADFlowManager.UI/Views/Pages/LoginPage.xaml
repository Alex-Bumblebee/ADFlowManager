<Page
    x:Class="ADFlowManager.UI.Views.Pages.LoginPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:local="clr-namespace:ADFlowManager.UI.Views.Pages"
    xmlns:ext="clr-namespace:ADFlowManager.UI.Extensions"
    Title="LoginPage"
    d:DesignHeight="650"
    d:DesignWidth="800"
    mc:Ignorable="d"
    KeyDown="Page_KeyDown">

    <Page.Background>
        <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
            <GradientStop Color="#0F0F0F" Offset="0" />
            <GradientStop Color="#1A1A1A" Offset="1" />
        </LinearGradientBrush>
    </Page.Background>

    <Grid VerticalAlignment="Center" HorizontalAlignment="Center">
        <!-- Card principale -->
        <Border
            x:Name="LoginCard"
            Width="450"
            MinHeight="550"
            Background="#1E1E1E"
            BorderBrush="#3F3F46"
            BorderThickness="1"
            CornerRadius="16"
            Padding="56"
            RenderTransformOrigin="0.5,0.5"
            Opacity="0">

            <Border.Effect>
                <DropShadowEffect
                    BlurRadius="20"
                    ShadowDepth="10"
                    Opacity="0.5"
                    Color="Black" />
            </Border.Effect>

            <Border.RenderTransform>
                <TransformGroup>
                    <TranslateTransform x:Name="CardTranslate" Y="40" />
                    <ScaleTransform x:Name="CardScale" ScaleX="0.95" ScaleY="0.95" />
                </TransformGroup>
            </Border.RenderTransform>

            <Border.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <!-- Fade in -->
                            <DoubleAnimation
                                Storyboard.TargetName="LoginCard"
                                Storyboard.TargetProperty="Opacity"
                                From="0" To="1" Duration="0:0:0.5">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>

                            <!-- Slide up -->
                            <DoubleAnimation
                                Storyboard.TargetName="CardTranslate"
                                Storyboard.TargetProperty="Y"
                                From="40" To="0" Duration="0:0:0.5">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>

                            <!-- Scale X -->
                            <DoubleAnimation
                                Storyboard.TargetName="CardScale"
                                Storyboard.TargetProperty="ScaleX"
                                From="0.95" To="1" Duration="0:0:0.5">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>

                            <!-- Scale Y -->
                            <DoubleAnimation
                                Storyboard.TargetName="CardScale"
                                Storyboard.TargetProperty="ScaleY"
                                From="0.95" To="1" Duration="0:0:0.5">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Border.Triggers>

            <StackPanel>
                <!-- === Header === -->
                <Image
                    Source="pack://application:,,,/Assets/logo.png"
                    Width="80"
                    Height="80"
                    HorizontalAlignment="Center"
                    RenderOptions.BitmapScalingMode="HighQuality" />

                <TextBlock
                    Text="ADFlowManager"
                    FontSize="32"
                    FontWeight="Bold"
                    Foreground="#F5F5F5"
                    HorizontalAlignment="Center"
                    Margin="0,16,0,8" />

                <TextBlock
                    Text="{ext:Localized Login_Subtitle}"
                    FontSize="14"
                    Foreground="#A1A1AA"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,40" />

                <!-- === Domain === -->
                <ui:TextBox
                    PlaceholderText="{ext:Localized Login_DomainPlaceholder}"
                    Text="{Binding Domain, UpdateSourceTrigger=PropertyChanged}"
                    Background="#2D2D30"
                    Foreground="#F5F5F5"
                    BorderBrush="#3F3F46"
                    Height="52"
                    FontSize="14"
                    Margin="0,0,0,24">
                    <ui:TextBox.Icon>
                        <ui:SymbolIcon Symbol="Globe24" Foreground="#8B5CF6" />
                    </ui:TextBox.Icon>
                </ui:TextBox>

                <!-- === Username === -->
                <ui:TextBox
                    PlaceholderText="{ext:Localized Login_UsernamePlaceholder}"
                    Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                    Background="#2D2D30"
                    Foreground="#F5F5F5"
                    BorderBrush="#3F3F46"
                    Height="52"
                    FontSize="14"
                    Margin="0,0,0,24">
                    <ui:TextBox.Icon>
                        <ui:SymbolIcon Symbol="Person24" Foreground="#8B5CF6" />
                    </ui:TextBox.Icon>
                </ui:TextBox>

                <!-- === Password === -->
                <ui:PasswordBox
                    PlaceholderText="{ext:Localized Login_PasswordPlaceholder}"
                    Password="{Binding Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    RevealButtonEnabled="True"
                    Background="#2D2D30"
                    Foreground="#F5F5F5"
                    BorderBrush="#3F3F46"
                    Height="52"
                    FontSize="14">
                    <ui:PasswordBox.Icon>
                        <ui:SymbolIcon Symbol="LockClosed24" Foreground="#8B5CF6" />
                    </ui:PasswordBox.Icon>
                </ui:PasswordBox>

                <!-- === Se souvenir de moi === -->
                <CheckBox
                    IsChecked="{Binding RememberMe}"
                    Content="{ext:Localized Login_RememberMe}"
                    Foreground="#A1A1AA"
                    FontSize="13"
                    Margin="0,16,0,0" />

                <TextBlock
                    Text="{ext:Localized Login_CredentialStorage}"
                    FontSize="11"
                    Foreground="#71717A"
                    Margin="24,4,0,0" />

                <!-- === Bouton Se connecter === -->
                <ui:Button
                    Command="{Binding LoginCommand}"
                    Appearance="Primary"
                    HorizontalAlignment="Stretch"
                    Height="52"
                    Margin="0,32,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock
                            Text="{Binding ButtonContent}"
                            VerticalAlignment="Center"
                            FontSize="16"
                            FontWeight="SemiBold" />
                        <ui:ProgressRing
                            Width="20"
                            Height="20"
                            Margin="8,0,0,0"
                            Foreground="White"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>
                </ui:Button>

                <!-- === Message d'erreur === -->
                <Border
                    Margin="0,16,0,0"
                    Padding="12"
                    CornerRadius="6"
                    BorderBrush="#EF4444"
                    BorderThickness="1"
                    Background="#332D2D30"
                    Visibility="{Binding ErrorVisibility}">
                    <TextBlock
                        Text="{Binding ErrorMessage}"
                        Foreground="#EF4444"
                        FontSize="13"
                        TextWrapping="Wrap" />
                </Border>
            </StackPanel>
        </Border>
    </Grid>
</Page>
