<Page
    x:Class="ADFlowManager.UI.Views.Pages.GroupsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:converters="clr-namespace:ADFlowManager.UI.Converters"
    xmlns:local="clr-namespace:ADFlowManager.UI.Views.Pages"
    xmlns:ext="clr-namespace:ADFlowManager.UI.Extensions"
    Title="{ext:Localized Nav_Groups}"
    d:DesignHeight="800"
    d:DesignWidth="1200"
    ScrollViewer.VerticalScrollBarVisibility="Disabled"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:InitialsConverter x:Key="InitialsConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:InverseNullToVisibilityConverter x:Key="InverseNullToVisibilityConverter" />
    </Page.Resources>

    <Grid Margin="24,8,24,16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- === TOOLBAR === -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Search box -->
            <ui:TextBox
                Grid.Column="0"
                PlaceholderText="{ext:Localized Groups_SearchPlaceholder}"
                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                Background="#2D2D30"
                Foreground="#F5F5F5"
                BorderBrush="#3F3F46"
                Height="44"
                FontSize="14"
                Margin="0,0,16,0">
                <ui:TextBox.Icon>
                    <ui:SymbolIcon Symbol="Search24" Foreground="#8B5CF6" />
                </ui:TextBox.Icon>
            </ui:TextBox>

            <!-- Group count badge -->
            <Border
                Grid.Column="1"
                Background="#8B5CF6"
                CornerRadius="20"
                Padding="16,8"
                VerticalAlignment="Center"
                Margin="0,0,16,0">
                <StackPanel Orientation="Horizontal">
                    <ui:SymbolIcon
                        Symbol="PeopleTeam24"
                        FontSize="18"
                        Foreground="White"
                        Margin="0,0,8,0" />
                    <TextBlock
                        FontSize="14"
                        FontWeight="SemiBold"
                        Foreground="White">
                        <Run Text="{Binding FilteredGroupsCount, Mode=OneWay}" />
                        <Run Text="{ext:Localized Groups_GroupCount}" />
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Actions toolbar -->
            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <ui:Button
                    Content="{ext:Localized Groups_SelectAll}"
                    Appearance="Secondary"
                    Command="{Binding SelectAllCommand}"
                    Height="44"
                    Margin="0,0,8,0"
                    Padding="16,0" />
                <ui:Button
                    Content="{ext:Localized Groups_DeselectAll}"
                    Appearance="Secondary"
                    Command="{Binding DeselectAllCommand}"
                    Height="44"
                    Margin="0,0,8,0"
                    Padding="16,0" />
                <ui:Button
                    Appearance="Secondary"
                    Command="{Binding RefreshCommand}"
                    ToolTip="{ext:Localized Groups_Refresh}"
                    Height="44"
                    Width="44"
                    Margin="0,0,8,0">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="ArrowSync24" />
                    </ui:Button.Icon>
                </ui:Button>
                <ui:Button
                    Content="{ext:Localized Groups_Create}"
                    Appearance="Primary"
                    Command="{Binding ShowCreateGroupCommand}"
                    Height="44"
                    Padding="16,0">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Add24" />
                    </ui:Button.Icon>
                </ui:Button>
            </StackPanel>
        </Grid>

        <!-- === CONTENT: DataGrid + Details === -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="7*" />
                <ColumnDefinition Width="16" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <!-- === LEFT: DataGrid Groupes === -->
            <Border
                Grid.Column="0"
                Background="#1E1E1E"
                BorderBrush="#3F3F46"
                BorderThickness="1"
                CornerRadius="8"
                ClipToBounds="True"
                MaxHeight="800"
                VerticalAlignment="Top">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                <DataGrid
                    Grid.Row="0"
                    x:Name="GroupsDataGrid"
                    ItemsSource="{Binding FilteredGroups}"
                    SelectedItem="{Binding SelectedGroup, Mode=TwoWay}"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    SelectionMode="Single"
                    CanUserSortColumns="True"
                    CanUserResizeColumns="True"
                    CanUserReorderColumns="False"
                    HeadersVisibility="Column"
                    GridLinesVisibility="None"
                    Background="Transparent"
                    Foreground="#F5F5F5"
                    BorderThickness="0"
                    RowHeaderWidth="0"
                    FontSize="13"
                    ScrollViewer.CanContentScroll="True"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                    MouseDoubleClick="DataGrid_MouseDoubleClick"
                    VirtualizingPanel.IsVirtualizing="True"
                    VirtualizingPanel.VirtualizationMode="Recycling"
                    EnableRowVirtualization="True">

                    <DataGrid.Resources>
                        <!-- Row style -->
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderBrush" Value="#2D2D30" />
                            <Setter Property="BorderThickness" Value="0,0,0,1" />
                            <Setter Property="MinHeight" Value="56" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2D2D30" />
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#3B2D5E" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>

                        <!-- Cell style -->
                        <Style TargetType="DataGridCell">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Foreground" Value="#F5F5F5" />
                            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Border
                                            Background="Transparent"
                                            Padding="12,8">
                                            <ContentPresenter VerticalAlignment="Center" />
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="Transparent" />
                                    <Setter Property="Foreground" Value="#F5F5F5" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>

                        <!-- Column header style -->
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#161616" />
                            <Setter Property="Foreground" Value="#A1A1AA" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                            <Setter Property="FontSize" Value="12" />
                            <Setter Property="Padding" Value="12,10" />
                            <Setter Property="BorderBrush" Value="#2D2D30" />
                            <Setter Property="BorderThickness" Value="0,0,0,1" />
                            <Setter Property="HorizontalContentAlignment" Value="Left" />
                        </Style>
                    </DataGrid.Resources>

                    <!-- Context Menu -->
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="{ext:Localized Groups_CopyName}" Command="{Binding CopyGroupNameCommand}" />
                            <MenuItem Header="{ext:Localized Groups_CopyDn}" Command="{Binding CopyDnCommand}" />
                        </ContextMenu>
                    </DataGrid.ContextMenu>

                    <DataGrid.Columns>
                        <!-- Checkbox sélection multiple -->
                        <DataGridTemplateColumn Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox
                                        IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Margin="-8,0,-8,0" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Avatar + Nom groupe -->
                        <DataGridTemplateColumn Header="{ext:Localized Groups_ColName}" Width="2*" SortMemberPath="GroupName">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <Border
                                            Width="36" Height="36"
                                            CornerRadius="18"
                                            Background="#8B5CF6"
                                            Margin="0,0,12,0">
                                            <ui:SymbolIcon
                                                Symbol="PeopleTeam24"
                                                FontSize="18"
                                                Foreground="White"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center" />
                                        </Border>
                                        <TextBlock
                                            Text="{Binding GroupName}"
                                            FontWeight="SemiBold"
                                            Foreground="#F5F5F5"
                                            FontSize="13"
                                            VerticalAlignment="Center" />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Description -->
                        <DataGridTemplateColumn Header="{ext:Localized Groups_ColDescription}" Width="3*" SortMemberPath="Description">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        Text="{Binding Description}"
                                        Foreground="#A1A1AA"
                                        FontSize="13"
                                        VerticalAlignment="Center"
                                        TextTrimming="CharacterEllipsis" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Nombre de membres -->
                        <DataGridTemplateColumn Header="{ext:Localized Groups_ColMembers}" Width="100" SortMemberPath="MemberCount">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <ui:SymbolIcon
                                            Symbol="People24"
                                            FontSize="16"
                                            Foreground="#8B5CF6"
                                            Margin="0,0,8,0" />
                                        <TextBlock
                                            Text="{Binding MemberCount}"
                                            FontWeight="SemiBold"
                                            Foreground="#F5F5F5"
                                            FontSize="13"
                                            VerticalAlignment="Center" />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                    <!-- Pagination footer -->
                    <Border
                        Grid.Row="1"
                        Background="#252525"
                        Padding="16,10"
                        BorderBrush="#3F3F46"
                        BorderThickness="0,1,0,0">
                        <TextBlock
                            FontSize="12"
                            Foreground="#71717A"
                            HorizontalAlignment="Center">
                            <Run Text="{ext:Localized Users_ShowingOf}"/>
                            <Run Text="{Binding FilteredGroups.Count, Mode=OneWay}" FontWeight="SemiBold" Foreground="#8B5CF6"/>
                            <Run Text="{ext:Localized Groups_GroupCount}"/>
                        </TextBlock>
                    </Border>
                </Grid>
            </Border>

            <!-- === RIGHT: Details Panel === -->
            <!-- Placeholder quand aucun groupe sélectionné -->
            <Border
                Grid.Column="2"
                Background="#1E1E1E"
                BorderBrush="#3F3F46"
                BorderThickness="1"
                CornerRadius="8"
                Padding="24"
                MaxHeight="800"
                VerticalAlignment="Top"
                Visibility="{Binding SelectedGroup, Converter={StaticResource InverseNullToVisibilityConverter}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ui:SymbolIcon
                        Symbol="PeopleTeam24"
                        FontSize="48"
                        Foreground="#3F3F46"
                        HorizontalAlignment="Center" />
                    <TextBlock
                        Text="{ext:Localized Groups_SelectGroup}"
                        FontSize="16"
                        Foreground="#71717A"
                        HorizontalAlignment="Center"
                        Margin="0,16,0,4" />
                    <TextBlock
                        Text="{ext:Localized Groups_ToViewMembers}"
                        FontSize="14"
                        Foreground="#52525B"
                        HorizontalAlignment="Center" />
                </StackPanel>
            </Border>

            <!-- ======================================================= -->
            <!-- Détails groupe sélectionné (1 seul groupe cliqué)       -->
            <!-- Masqué si HasMultipleChecked = true                     -->
            <!-- ======================================================= -->
            <Border
                Grid.Column="2"
                Background="#1E1E1E"
                BorderBrush="#3F3F46"
                BorderThickness="1"
                CornerRadius="8"
                MaxHeight="800"
                VerticalAlignment="Top">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="{Binding SelectedGroup, Converter={StaticResource NullToVisibilityConverter}}" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasMultipleChecked}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="24">
                        <!-- Avatar + Nom groupe -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <Border
                                Width="48" Height="48"
                                CornerRadius="24"
                                Background="#8B5CF6">
                                <ui:SymbolIcon
                                    Symbol="PeopleTeam24"
                                    FontSize="24"
                                    Foreground="White"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                <TextBlock
                                    Text="{Binding SelectedGroup.GroupName}"
                                    FontSize="16"
                                    FontWeight="SemiBold"
                                    Foreground="#F5F5F5" />
                                <TextBlock
                                    FontSize="12"
                                    Foreground="#A1A1AA"
                                    Margin="0,2,0,0">
                                    <Run Text="{Binding SelectedGroup.MemberCount, Mode=OneWay}" />
                                    <Run Text="{ext:Localized Groups_MemberCount}" />
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>

                        <!-- Séparateur -->
                        <Border Height="1" Background="#3F3F46" Margin="0,0,0,20" />

                        <!-- Informations -->
                        <TextBlock
                            Text="{ext:Localized Groups_Information}"
                            FontSize="11"
                            FontWeight="Bold"
                            Foreground="#71717A"
                            Margin="0,0,0,12" />

                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="{ext:Localized Groups_Description}" FontSize="11" Foreground="#71717A" />
                            <TextBlock
                                Text="{Binding SelectedGroup.Description}"
                                FontSize="14" Foreground="#F5F5F5"
                                TextWrapping="Wrap"
                                Margin="0,2,0,0" />
                        </StackPanel>

                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="{ext:Localized Users_DistinguishedName}" FontSize="11" Foreground="#71717A" />
                            <TextBlock
                                Text="{Binding SelectedGroup.DistinguishedName}"
                                FontSize="12" Foreground="#A1A1AA"
                                TextWrapping="Wrap"
                                Margin="0,2,0,0" />
                        </StackPanel>

                        <!-- Séparateur -->
                        <Border Height="1" Background="#3F3F46" Margin="0,0,0,20" />

                        <!-- Membres -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Grid.Column="0"
                                Text="{ext:Localized Groups_ColMembers}"
                                FontSize="11"
                                FontWeight="Bold"
                                Foreground="#71717A"
                                VerticalAlignment="Center" />
                            <TextBlock
                                Grid.Column="1"
                                Text="{ext:Localized Groups_DoubleClick}"
                                FontSize="11"
                                Foreground="#52525B"
                                FontStyle="Italic"
                                VerticalAlignment="Center" />
                        </Grid>

                        <!-- Liste des membres -->
                        <ItemsControl ItemsSource="{Binding SelectedGroup.Members}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Background="#2D2D30"
                                        CornerRadius="8"
                                        Padding="12"
                                        Margin="0,0,0,8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <Border
                                                Grid.Column="0"
                                                Width="32" Height="32"
                                                CornerRadius="16"
                                                Background="#3B2D5E"
                                                Margin="0,0,10,0">
                                                <TextBlock
                                                    Text="{Binding DisplayName, Converter={StaticResource InitialsConverter}}"
                                                    FontSize="12"
                                                    FontWeight="Bold"
                                                    Foreground="#8B5CF6"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center" />
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock
                                                    Text="{Binding DisplayName}"
                                                    FontSize="13"
                                                    Foreground="#F5F5F5" />
                                                <TextBlock
                                                    Text="{Binding UserName}"
                                                    FontSize="11"
                                                    Foreground="#71717A"
                                                    Margin="0,2,0,0" />
                                            </StackPanel>

                                            <!-- Remove member button -->
                                            <ui:Button
                                                Grid.Column="2"
                                                Appearance="Secondary"
                                                VerticalAlignment="Center"
                                                Width="28"
                                                Height="28"
                                                Padding="0"
                                                ToolTip="{ext:Localized Groups_RemoveTooltip}"
                                                Click="RemoveMemberButton_Click"
                                                CommandParameter="{Binding}">
                                                <ui:Button.Icon>
                                                    <ui:SymbolIcon Symbol="Dismiss24" FontSize="12" />
                                                </ui:Button.Icon>
                                            </ui:Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Message si aucun membre -->
                        <TextBlock
                            Text="{ext:Localized Groups_NoMembers}"
                            FontSize="13"
                            Foreground="#52525B"
                            FontStyle="Italic"
                            HorizontalAlignment="Center"
                            Margin="0,8,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedGroup.MemberCount}" Value="0">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Séparateur -->
                        <Border Height="1" Background="#3F3F46" Margin="0,16,0,20" />

                        <!-- Actions (single group) -->
                        <TextBlock
                            Text="{ext:Localized Groups_Actions}"
                            FontSize="11"
                            FontWeight="Bold"
                            Foreground="#71717A"
                            Margin="0,0,0,12" />

                        <ui:Button
                            Content="{ext:Localized Groups_AddMembers}"
                            Appearance="Primary"
                            Click="AddMembersButton_Click"
                            HorizontalAlignment="Stretch"
                            Height="40"
                            Margin="0,0,0,8">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="PersonAdd24" />
                            </ui:Button.Icon>
                        </ui:Button>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- ======================================================= -->
            <!-- Panel multi-sélection (quand plusieurs groupes cochés)  -->
            <!-- ======================================================= -->
            <Border
                Grid.Column="2"
                Background="#1E1E1E"
                BorderBrush="#3F3F46"
                BorderThickness="1"
                CornerRadius="8"
                MaxHeight="800"
                VerticalAlignment="Top"
                Padding="24">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasMultipleChecked}" Value="True">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <StackPanel>
                    <!-- Header -->
                    <StackPanel HorizontalAlignment="Center" Margin="0,0,0,24">
                        <Border
                            Width="72" Height="72"
                            CornerRadius="36"
                            Background="#3B2D5E"
                            HorizontalAlignment="Center"
                            Margin="0,0,0,12">
                            <ui:SymbolIcon
                                Symbol="PeopleTeam24"
                                FontSize="32"
                                Foreground="#8B5CF6"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Border>
                        <TextBlock
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="#F5F5F5"
                            HorizontalAlignment="Center">
                            <Run Text="{Binding SelectedGroupsCount, Mode=OneWay}" />
                            <Run Text="{ext:Localized Groups_GroupsWord}" />
                        </TextBlock>
                        <TextBlock
                            Text="{ext:Localized Groups_Selected}"
                            FontSize="14"
                            Foreground="#A1A1AA"
                            HorizontalAlignment="Center"
                            Margin="0,4,0,0" />
                    </StackPanel>

                    <!-- Séparateur -->
                    <Border Height="1" Background="#3F3F46" Margin="0,0,0,20" />

                    <!-- Actions bulk -->
                    <TextBlock
                        Text="{ext:Localized Groups_BulkActions}"
                        FontSize="11"
                        FontWeight="Bold"
                        Foreground="#71717A"
                        Margin="0,0,0,12" />

                    <ui:Button
                        Content="{ext:Localized Groups_BulkAddMembers}"
                        Appearance="Primary"
                        Click="BulkAddMembersButton_Click"
                        HorizontalAlignment="Stretch"
                        Height="40">
                        <ui:Button.Icon>
                            <ui:SymbolIcon Symbol="PersonAdd24" />
                        </ui:Button.Icon>
                    </ui:Button>
                </StackPanel>
            </Border>
        </Grid>

        <!-- === CREATE GROUP PANEL (overlay) === -->
        <Border
            Grid.Row="0"
            Grid.RowSpan="2"
            Background="#CC0F0F0F"
            Panel.ZIndex="998">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsCreateGroupVisible}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <Border
                Background="#1E1E1E"
                BorderBrush="#8B5CF6"
                BorderThickness="1"
                CornerRadius="12"
                Padding="32"
                Width="500"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                        <Border
                            Width="40" Height="40"
                            CornerRadius="20"
                            Background="#3B2D5E"
                            Margin="0,0,12,0">
                            <ui:SymbolIcon
                                Symbol="PeopleTeam24"
                                FontSize="20"
                                Foreground="#8B5CF6"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Border>
                        <TextBlock
                            Text="{ext:Localized GroupCreate_Title}"
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="#F5F5F5"
                            VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Nom du groupe -->
                    <StackPanel Margin="0,0,0,16">
                        <TextBlock Text="{ext:Localized GroupCreate_Name}" FontSize="13" Foreground="#A1A1AA" Margin="0,0,0,4" />
                        <ui:TextBox
                            Text="{Binding NewGroupName, UpdateSourceTrigger=PropertyChanged}"
                            PlaceholderText="GRP_MonGroupe"
                            Background="#2D2D30"
                            Foreground="#F5F5F5"
                            BorderBrush="#3F3F46"
                            Height="40" />
                    </StackPanel>

                    <!-- Description -->
                    <StackPanel Margin="0,0,0,16">
                        <TextBlock Text="{ext:Localized GroupCreate_Description}" FontSize="13" Foreground="#A1A1AA" Margin="0,0,0,4" />
                        <ui:TextBox
                            Text="{Binding NewGroupDescription, UpdateSourceTrigger=PropertyChanged}"
                            PlaceholderText="Description du groupe"
                            Background="#2D2D30"
                            Foreground="#F5F5F5"
                            BorderBrush="#3F3F46"
                            Height="40" />
                    </StackPanel>

                    <!-- OU de destination -->
                    <StackPanel Margin="0,0,0,16">
                        <TextBlock Text="{ext:Localized GroupCreate_OU}" FontSize="13" Foreground="#A1A1AA" Margin="0,0,0,4" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ui:TextBox
                                Grid.Column="0"
                                Text="{Binding NewGroupOU, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="OU=Groups,DC=contoso,DC=local"
                                Background="#2D2D30"
                                Foreground="#F5F5F5"
                                BorderBrush="#3F3F46"
                                Height="40" />
                            <ui:Button
                                Grid.Column="1"
                                ToolTip="Parcourir les OUs"
                                Appearance="Secondary"
                                Click="BrowseGroupOU_Click"
                                Height="40"
                                Width="40"
                                Margin="8,0,0,0">
                                <ui:Button.Icon>
                                    <ui:SymbolIcon Symbol="FolderOpen24" />
                                </ui:Button.Icon>
                            </ui:Button>
                        </Grid>
                    </StackPanel>

                    <!-- Type et Portée -->
                    <Grid Margin="0,0,0,24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Type" FontSize="13" Foreground="#A1A1AA" Margin="0,0,0,4" />
                            <ComboBox
                                ItemsSource="{Binding GroupTypes}"
                                SelectedIndex="{Binding NewGroupTypeIndex}"
                                Background="#2D2D30"
                                Foreground="#F5F5F5"
                                BorderBrush="#3F3F46"
                                Height="40" />
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Portée" FontSize="13" Foreground="#A1A1AA" Margin="0,0,0,4" />
                            <ComboBox
                                ItemsSource="{Binding GroupScopes}"
                                SelectedIndex="{Binding NewGroupScopeIndex}"
                                Background="#2D2D30"
                                Foreground="#F5F5F5"
                                BorderBrush="#3F3F46"
                                Height="40" />
                        </StackPanel>
                    </Grid>

                    <!-- Boutons -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <ui:Button
                            Content="{ext:Localized Common_Cancel}"
                            Appearance="Secondary"
                            Command="{Binding HideCreateGroupCommand}"
                            Height="40"
                            Padding="20,0"
                            Margin="0,0,8,0" />
                        <ui:Button
                            Content="{ext:Localized GroupCreate_Create}"
                            Appearance="Primary"
                            Command="{Binding CreateGroupCommand}"
                            Height="40"
                            Padding="20,0">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="Add24" />
                            </ui:Button.Icon>
                        </ui:Button>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Border>

        <!-- Loader overlay -->
        <Border
            Grid.Row="0"
            Grid.RowSpan="2"
            Background="#CC0F0F0F"
            Panel.ZIndex="999">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsLoading}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <ui:ProgressRing
                    IsIndeterminate="True"
                    Width="48"
                    Height="48"
                    Foreground="#8B5CF6"
                    Margin="0,0,0,16"/>
                <TextBlock
                    Text="{ext:Localized Common_Loading}"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Foreground="#F5F5F5"
                    HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>
